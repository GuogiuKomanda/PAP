<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://java.sun.com/jsf/html" xmlns:f="http://java.sun.com/jsf/core" xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a4j="http://richfaces.org/a4j" xmlns:rich="http://richfaces.org/rich" xmlns:fn="http://java.sun.com/jsp/jstl/functions">

	<rich:extendedDataTable value="#{saskaitaListBean.dataModel}" var="saskaita" id="saskaitaListTable" style="height:50%;" selectionMode="single" selection="#{saskaitaListBean.selection}">

		<a4j:ajax event="selectionchange" listener="#{saskaitaListBean.selectionListener}" render="saskaitosEiluteListTable" />

		<f:facet name="header">
			<h:outputText value="Saskaitos" />
		</f:facet>

		<rich:column>
			<f:facet name="header">
				<h:outputText value="Pavadinimas" />
			</f:facet>
			<h:outputText value="#{saskaita.pavadinimas}" />
		</rich:column>

		<rich:column>
			<f:facet name="header">
				<h:outputText value="Data" />
			</f:facet>
			<h:outputText value="#{saskaita.dataString}" />
		</rich:column>

		<rich:column>
			<f:facet name="header">
				<h:outputText value="Suma" />
			</f:facet>
			<h:outputText value="#{saskaita.suma}" />
		</rich:column>

		<rich:column>
			<f:facet name="header">
				<h:outputText value="Kiekis" />
			</f:facet>
			<h:outputText value="#{saskaita.kiekis}" />
		</rich:column>

		<rich:column>
			<f:facet name="header">
				<h:outputText value="Tiekejas" />
			</f:facet>
			<h:outputText value="#{saskaita.tiekejasString}" />
		</rich:column>

		<rich:column>
			<f:facet name="header">
				<h:outputText value="Pirkimo vadybininkas" />
			</f:facet>
			<h:outputText value="#{saskaita.pardavimoVadybininkasString}" />
		</rich:column>

		<rich:column>
			<f:facet name="header">
				<h:outputText value="Veiksmai" />
			</f:facet>
			<a4j:region>
				<a4j:commandLink ajaxSingle="true" id="editSaskaitaLink" oncomplete="#{rich:component('editSaskaitaPanel')}.show()" action="#{saskaitaListBean.actEdit}" render="editSaskaitaPanel">
					<h:graphicImage value="/images/icons/edit.gif" style="border:0" />
					<f:setPropertyActionListener value="#{saskaita}" target="#{saskaitaListBean.currentItem}" />
				</a4j:commandLink>

				<a4j:commandLink ajaxSingle="true" id="deletesaskaitaLink" oncomplete="#{rich:component('deleteSaskaitaPanel')}.show()" action="#{saskaitaListBean.actEdit}" rendered="#{not empty saskaita.id}" render="deleteSaskaitaPanel">
					<h:graphicImage value="/images/icons/delete.gif" style="border:0" />
					<f:setPropertyActionListener value="#{saskaita}" target="#{saskaitaListBean.currentItem}" />
				</a4j:commandLink>
			</a4j:region>

		</rich:column>

	</rich:extendedDataTable>

	<rich:popupPanel header="Redaguoti sąskaitą" id="editSaskaitaPanel" domElementAttachment="parent" width="450" height="200">
		<h:panelGrid columns="3">
			<h:outputText value="Pavadinimas" />
			<h:inputText value="#{saskaitaListBean.edit.pavadinimas}" />
			<h:panelGroup />
			
            <h:outputText value="Data" />
		    <rich:calendar value="#{saskaitaListBean.edit.data}" locale="LT" popup="true" datePattern="yyyy-MM-dd" showApplyButton="true" 
		    	cellWidth="24px" cellHeight="22px" style="width:200px">
            </rich:calendar>
            <h:panelGroup />
            
			<h:outputText value="Pirkimo vadybininkas" />
			<rich:select value="#{saskaitaListBean.edit.pardavimoVadybininkas}" converter="vadybininkasConverter">
				<f:selectItems value="#{vadybininkasManager.pirkimoVadybininkasList}" />
			</rich:select>
			<h:panelGroup />
			
			<h:outputText value="Tiekėjas" />
			<rich:select value="#{saskaitaListBean.edit.tiekejas}" converter="subjektasConverter">
				<f:selectItems value="#{subjektasManager.tiekejasList}" />
			</rich:select>
			<h:panelGroup />	
		</h:panelGrid>
		<a4j:commandButton value="Patvirtinti" action="#{saskaitaListBean.store}" render="saskaitaListTable" execute="editSaskaitaPanel"
			oncomplete="if (#{facesContext.maximumSeverity==null}) {#{rich:component('editSaskaitaPanel')}.hide();}" />
		<a4j:commandButton value="Atšaukti" onclick="#{rich:component('editSaskaitaPanel')}.hide(); return false;" />
	</rich:popupPanel>

	<a4j:jsFunction name="removeSaskaita" action="#{saskaitaListBean.delete}" render="saskaitaListTable" execute="@this" oncomplete="#{rich:component('deleteSaskaitaPanel')}.hide();" />

	<rich:popupPanel id="deleteSaskaitaPanel" autosized="true" header="Ištrinti sąskaitą?">
		<h:panelGrid columns="3">
			<h:outputText value="Pavadinimas" />
			<h:outputText value="#{saskaitaListBean.edit.pavadinimas}" />
			<h:panelGroup />
		</h:panelGrid>
		<a4j:commandButton value="Atšaukti" onclick="#{rich:component('deleteSaskaitaPanel')}.hide(); return false;" />
		<a4j:commandButton value="Ištrinti" onclick="removeSaskaita(); return false;" />
	</rich:popupPanel>

	<!--rich:jQuery selector="#testJS" query="keypress(function(event){var keycode = (event.keyCode ? event.keyCode : event.which); if(keycode == '13'){alert('You pressed a Enter key in textbox');}event.stopPropagation();});"/-->

	<rich:extendedDataTable value="#{saskaitosEiluteListBean.dataModel}" var="saskaitosEilute" id="saskaitosEiluteListTable" style="height:50%;" selectionMode="single"
		selection="#{saskaitosEiluteListBean.selection}">

		<a4j:ajax event="selectionchange" listener="#{saskaitosEiluteListBean.selectionListener}" />

		<f:facet name="header">
			<h:outputText value="Prekės" />
		</f:facet>
		
		<rich:column filterExpression="#{fn:containsIgnoreCase(saskaitosEilute.uzsakymoNumeris,saskaitosEiluteListBean.uzsakymoNumerisFilter)}" filterType="custom">
			<f:facet name="header">
				<h:panelGroup>
					<h:outputText value="Užsakymo Numeris " />
					<h:inputText value="#{saskaitosEiluteListBean.uzsakymoNumerisFilter}" onkeypress="check(event);">
						<a4j:ajax event="blur" render="saskaitosEiluteListTable" execute="@this" />
					</h:inputText>
				</h:panelGroup>
			</f:facet>
			<h:outputText value="#{saskaitosEilute.uzsakymoNumeris}" />
		</rich:column>

		<rich:column filterExpression="#{fn:containsIgnoreCase(saskaitosEilute.prekesNumeris,saskaitosEiluteListBean.prekesNumerisFilter)}" filterType="custom">
			<f:facet name="header">
				<h:panelGroup>
					<h:outputText value="Prekės Numeris"  />
					<h:inputText value="#{saskaitosEiluteListBean.prekesNumerisFilter}" onkeypress="check(event);">
						<a4j:ajax event="blur" render="saskaitosEiluteListTable" execute="@this" />
					</h:inputText>
				</h:panelGroup>
			</f:facet>
			<h:outputText value="#{saskaitosEilute.prekesNumeris}" />
		</rich:column>
		<rich:column>
			<f:facet name="header">
				<h:outputText value="Prekės Pavadinimas" />
			</f:facet>
			<h:outputText value="#{saskaitosEilute.prekesPavadinimas}" />
		</rich:column>
		<rich:column>
			<f:facet name="header">
				<h:outputText value="Kiekis" />
			</f:facet>
			<h:outputText value="#{saskaitosEilute.kiekis}" />
		</rich:column>
		<rich:column>
			<f:facet name="header">
				<h:outputText value="Vieneto Kaina" />
			</f:facet>
			<h:outputText value="#{saskaitosEilute.kaina}" />
		</rich:column>
				<rich:column>
			<f:facet name="header">
				<h:outputText value="Suma" />
			</f:facet>
			<h:outputText value="#{saskaitosEilute.sumaString}" />
		</rich:column>
		<rich:column>
			<f:facet name="header">
				<h:outputText value="Vieneto Svoris" />
			</f:facet>
			<h:outputText value="#{saskaitosEilute.prekesSvoris}" />
		</rich:column>
		<rich:column>
			<f:facet name="header">
				<h:outputText value="Netto" />
			</f:facet>
			<h:outputText value="#{saskaitosEilute.nettoString}" />
		</rich:column>
		
		<rich:column filterExpression="#{fn:containsIgnoreCase(saskaitosEilute.prekesGrupesPavadinimas,saskaitosEiluteListBean.grupeFilter)}" filterType="custom">
			<f:facet name="header">
				<h:panelGroup>
					<h:outputText value="Grupės Pavadinimas " />
					<h:inputText value="#{saskaitosEiluteListBean.grupeFilter}" onkeypress="check(event);">
						<a4j:ajax event="blur" render="saskaitosEiluteListTable" execute="@this" />
					</h:inputText>
				</h:panelGroup>
			</f:facet>
			<h:outputText value="#{saskaitosEilute.prekesGrupesPavadinimas}" />
		</rich:column>

		<rich:column>
			<f:facet name="header">
				<h:outputText value="Veiksmai" />
			</f:facet>
			<a4j:region>
				<a4j:commandLink ajaxSingle="true" id="editSaskaitosEiluteLink" oncomplete="#{rich:component('editSaskaitosEilutePanel')}.show()" action="#{saskaitosEiluteListBean.actEdit}" render="editSaskaitosEilutePanel">
					<h:graphicImage value="/images/icons/edit.gif" style="border:0" />
					<f:setPropertyActionListener value="#{saskaitosEilute}" target="#{saskaitosEiluteListBean.currentItem}" />
				</a4j:commandLink>

				<a4j:commandLink ajaxSingle="true" id="deleteSaskaitosEiluteLink" oncomplete="#{rich:component('deleteSaskaitosEilutePanel')}.show()" action="#{saskaitosEiluteListBean.actEdit}" rendered="#{not empty saskaitosEilute.id}" render="deleteSaskaitosEilutePanel">
					<h:graphicImage value="/images/icons/delete.gif" style="border:0" />
					<f:setPropertyActionListener value="#{saskaitosEilute}" target="#{saskaitosEiluteListBean.currentItem}" />
				</a4j:commandLink>
			</a4j:region>
		</rich:column>

	</rich:extendedDataTable>

	<rich:popupPanel id="editSaskaitosEilutePanel" header="Redaguoti sąskaitos eilutę" domElementAttachment="parent" autosized="true">
		<h:panelGrid columns="3" rendered="#{not empty saskaitosEiluteListBean.edit}" id="editSaskaitosEilutePanelGrid">
			<h:outputText value="Užsakymo Numeris" />
			<rich:select enableManualInput="true" defaultLabel="Pradėkite vesti numerį" value="#{saskaitosEiluteListBean.edit.uzsakymoNumeris}">
				<f:selectItems value="#{uzsakymasManager.uzsakymoNumerisList}" />
				<a4j:ajax event="selectitem" execute="@this" render="editSaskaitaPrekesNrSelect" listener="#{saskaitosEiluteListBean.uzsakymoNumerisChangeListener}"/>
			</rich:select>
			<h:panelGroup />
			
			<h:outputText value="Prekės Numeris" />
			<rich:select id="editSaskaitaPrekesNrSelect" enableManualInput="true" defaultLabel="Pradėkite vesti numerį"	value="#{saskaitosEiluteListBean.edit.prekesNumeris}">
				<f:selectItems value="#{prekeManager.getPrekesNumerisList(saskaitosEiluteListBean.edit.uzsakymoNumeris)}" />
				<a4j:ajax event="selectitem" execute="@this" listener="#{saskaitosEiluteListBean.prekesNumerisChangeListener}" render="editSaskaitosEilutePanelGrid"/>
			</rich:select>
			<h:panelGroup />
			
			<h:outputText value="Prekės Pavadinimas" />
			<h:outputText value="#{saskaitosEiluteListBean.edit.prekesPavadinimas}" />
			<h:panelGroup />
			
			<h:outputText value="Kiekis" />
			<rich:inplaceInput id="saskaitosEiluteKiekis" value="#{saskaitosEiluteListBean.edit.kiekis}" editEvent="click" converterMessage="Ne skaičius!">
				<a4j:ajax event="blur" render="editSaskaitosEilutePanelGrid" />
				<f:validator validatorId="moreThanZero" />
			</rich:inplaceInput>
			<rich:message for="saskaitosEiluteKiekis"/>
			
			<h:outputText value="Vieneto Kaina" />
			<rich:inplaceInput id="saskaitosEiluteVienetoKaina" value="#{saskaitosEiluteListBean.edit.kaina}" editEvent="dblclick" converterMessage="Ne skaičius!">
				<a4j:ajax event="blur" render="editSaskaitosEilutePanelGrid" />
				<f:validator validatorId="moreThanZero" />
			</rich:inplaceInput>
			<rich:message for="saskaitosEiluteVienetoKaina"/>
			
			<h:outputText value="Suma" />
			<h:outputText value="#{saskaitosEiluteListBean.edit.sumaString}" />
			<h:panelGroup />
			
			<h:outputText value="Vieneto Svoris" />
			<h:outputText value="#{saskaitosEiluteListBean.edit.prekesSvoris}" />
			<h:panelGroup />
			
			<h:outputText value="Netto" />
			<h:outputText value="#{saskaitosEiluteListBean.edit.nettoString}" />
			<h:panelGroup />			
			
			<h:outputText value="Grupės Pavadinimas" />
			<h:outputText value="#{saskaitosEiluteListBean.edit.prekesGrupesPavadinimas}" />
			<h:panelGroup />
			
			<!--h:outputText value="VIN" />
                <h:inputText value="#{carsBean.editedCar.vin}" id="vin" required="true"
                    validatorMessage="Not a valid 17-digit VIN" converterMessage="Not a valid 17-digit VIN"
                    requiredMessage="VIN is required">
                    <f:validateLength minimum="17" maximum="17" />
                </h:inputText>
                <rich:message id="vinMsg" for="vin" /-->
		</h:panelGrid>
		<a4j:commandButton value="Išsaugoti" action="#{saskaitosEiluteListBean.store}" render="saskaitaListTable,saskaitosEiluteListTable" execute="editSaskaitosEilutePanel"
			oncomplete="if (#{facesContext.maximumSeverity==null}) {#{rich:component('editSaskaitosEilutePanel')}.hide();}" />
		<a4j:commandButton value="Atšaukti" onclick="#{rich:component('editSaskaitosEilutePanel')}.hide(); return false;" />
	</rich:popupPanel>

	<a4j:jsFunction name="removeSaskaitosEilute" action="#{saskaitosEiluteListBean.delete}" render="saskaitaListTable,saskaitosEiluteListTable" execute="@this" oncomplete="#{rich:component('deleteSaskaitosEilutePanel')}.hide();" />

	<rich:popupPanel id="deleteSaskaitosEilutePanel" autosized="true" header="Ištrinti sąskaitos eilutę?">
		<h:panelGrid columns="3"  rendered="#{not empty saskaitosEiluteListBean.edit}">
			<h:outputText value="Užsakymas" />
			<h:outputText value="#{saskaitosEiluteListBean.edit.uzsakymoNumeris}" />
			<h:panelGroup />
			<h:outputText value="Prekės Numeris" />
			<h:outputText value="#{saskaitosEiluteListBean.edit.prekesNumeris}" />
			<h:panelGroup />
			<h:outputText value="Prekės Pavadinimas" />
			<h:outputText value="#{saskaitosEiluteListBean.edit.prekesPavadinimas}" />
			<h:panelGroup />
		</h:panelGrid>
		<a4j:commandButton value="Atšaukti" onclick="#{rich:component('deleteSaskaitosEilutePanel')}.hide(); return false;" />
		<a4j:commandButton value="Ištrinti" onclick="removeSaskaitosEilute(); return false;" />
	</rich:popupPanel>

	<!-- *************************************************************************************************************************************************************** -->
	<!--a4j:status onstart="#{rich:component('wait')}.show()" onstop="#{rich:component('wait')}.hide()" />
	<rich:popupPanel id="wait" autosized="true" width="200" height="120" moveable="false" resizeable="false">
		<f:facet name="header">
			<h:outputText value="Vykdoma operacija" />
		</f:facet>
		<h:outputText value="Laukite..." />
	</rich:popupPanel>
	<rich:messages></rich:messages-->
</ui:composition>